# Предметная область
Согласно официальным данным Всемирной организации здравоохранения (ВОЗ), нетравматические и травматические внутричерепные кровоизлияния являются одной из главных причин высокой смертности и инвалидизации населения в мире. При этом подчеркивается, что около 50-60% летальных исходов при травмах приходится именно на черепно-мозговые травмы (ЧМТ). Кроме того, для ЧМТ также характерна высокая частота разнообразных последствий, которые могут выражаться в виде астенических, вегетативных, когнитивных, неврологических, психических и двигательных нарушениях. По значимости нанесения медико-социального ущерба мировому сообществу ЧМТ занимают второе место, уступая лишь заболеваниям системы кровообращения и онкологическим патологиям. При этом в Российской Федерации ЧМТ являются наиболее распространенным видом травм среди лиц молодого и среднего возраста и обуславливаются бытовым или производственным травматизмом, употреблением спиртных напитков, а также дорожно-транспортными происшествиями. Высокая распространенность ЧМТ в России подтверждается рядом эпидемиологических исследований – примерно 4 случая и выше на 1000 населения или 600 тыс. пострадавших в год, из них погибают около 50 тыс. человек и еще столько же становятся инвалидами.

Черепно-мозговая травма определяется как физиологическое повреждение черепа и внутричерепного содержимого, в том числе мозговых оболочек, сосудов, черепно-мозговых нервов, вызванное внешним механическим воздействием и приводящее к постоянным или временным нарушениям когнитивных, физических и психосоциальных функций с соответствующим ухудшением или изменением состояния сознания пострадавшего.

Рост активного использования интеллектуальных информационных систем и, в частности, искусственных нейронных сетей (ИНС) в нейрорадиологии прежде всего связан с развитием медицинских диагностических технологий и расширением доступности компьютерной томографии (КТ), что в свою очередь стало причиной колоссального увеличения объема анализируемых данных и, как следствие, времени, необходимого для их дальнейшей интерпретации специалистами. Очевидно, что ручная расшифровка КТ-исследований головного мозга требует достаточно больших временных затрат и может быть подвержена ошибкам особенно в экстренных случаях, связанных с тяжелыми ЧМТ, которые требуют скорейшего оказания неотложной нейрохирургической помощи. ИНС позволяют автоматизировать процесс анализа КТ-исследований, сокращая объем времени, необходимый для проведения диагностических мероприятий, снижая вероятность постановки неверного диагноза и улучшая таким образом качество лечения пациентов с ЧМТ.

# Основная информация о работе
В процессе выполнения данной работы из репозитория конкурса по классификации внутречерепных кровоизлияний [Code for 1st Place Solution in Intracranial Hemorrhage Detection Challenge @ RSNA2019](https://github.com/SeuTao/RSNA2019_Intracranial-Hemorrhage-Detection/tree/master)
были взаимствованы только веса модели глубокого обучения DenseNet121_512*512. Инференс модели и предобработка медицинских изображений в формате DICOM были реализованы
самостоятельно ввиду их отсутствия в опорном проекте.

# Инструкция по запуску проекта
1) Скопируйте настоящий репозиторий:
   
    ```console
    git clone https://github.com/MLSukhanov/DeepLearningCourse.git
    ```

2) Перейдите в директорию со скопированным репозиторием с помощью команды cd:
    ```console
    cd DeepLearningCourse
    ```
    
3) Cоздайте в этой директории три пустых папки, используя команду mkdir:
   ```console
   mkdir output
   mkdir temppng
   mkdir weights
   ```
   После выполнения третьего шага инструкции дерево файловой структуры проекта должно выглядеть так, как это показано на схеме ниже:
   ```bash
   ├── dcm
   │   ├── IMG-0008-00226.dcm
   │   ├── IMG-0008-00250.dcm
   │   ├── IMG-0008-00271.dcm
   │   └── IMG-0008-00303.dcm
   ├── etalon
   │   ├── IMG-0008-00226.png
   │   ├── IMG-0008-00250.png
   │   ├── IMG-0008-00271.png
   │   ├── IMG-0008-00303.png
   │   ├── predictions.txt
   │   └── time.txt
   ├── output
   │   └── 
   ├── src
   │   ├── inference.py
   │   ├── preprocess.py
   │   └── run_and_compare.txt
   ├── temppng
   │   └── 
   ├── weights
   │   └── 
   ├── Dockerfile
   ├── README.md
   └── requirements.txt
   ```
  
4) Скачайте веса модели DenseNet121 по [ссылке](https://drive.google.com/drive/folders/1HNfpwCGTEr1p6-g0dvUWQYmvR4N7Bbyp?usp=sharing) и разместите их в папке weights. Таким образом, в папке weights должны находиться только пять файлов формата .pth:
   ```bash
   ├── dcm
   │   ├── IMG-0008-00226.dcm
   │   ├── IMG-0008-00250.dcm
   │   ├── IMG-0008-00271.dcm
   │   └── IMG-0008-00303.dcm
   ├── etalon
   │   ├── IMG-0008-00226.png
   │   ├── IMG-0008-00250.png
   │   ├── IMG-0008-00271.png
   │   ├── IMG-0008-00303.png
   │   ├── predictions.txt
   │   └── time.txt
   ├── output
   ├── src
   │   ├── inference.py
   │   ├── preprocess.py
   │   └── run_and_compare.txt
   ├── temppng
   ├── weights
   │   ├── model_epoch_best_0.pth
   │   ├── model_epoch_best_1.pth
   │   ├── model_epoch_best_2.pth
   │   ├── model_epoch_best_3.pth
   │   └── model_epoch_best_4.pth
   ├── Dockerfile
   ├── README.md
   └── requirements.txt
   ```

5) Запустите приложение Docker Desktop

6) Запустите Windows PowerShell, если не сделали этого ранее (при использовании командной строки наблюдались проблемы с кодировкой вывода, что в итоге приводило к тотальной неработоспособности проекта)
   
7) Выполните команду для сборки образа Docker:
    ```console
    docker build -t classifseven .
    ```
    ##### *Примечание: здесь `classifseven` означает текстовое название образа Docker. В случае существования образа с таким же именем его необходимо изменить на                     незанятое в команде выше.*
    
8) Запустите Docker контейнер с помощью следующей команды:
    ```console
    docker run -it --name conclassifseven classifseven
    ```
    ##### *Примечание: здесь `conclassifseven` означает текстовое название контейнера Docker. В случае существования контейнера с таким же именем его необходимо изменить на          незанятое в команде выше. В случае изменения названия Docker образа в пункте 8 его также следует изменить в команде выше.*
    
9) Вы можете скопировать выходной файл отчета predictions.txt из Docker контейнера под названием `conclassifseven` на хост с использованием следующей команды:
    ```console
    docker cp conclassifseven:/app/output/predictions.txt <абсолютный путь до директории, в которую Вы хотите сохранить отчет классификации>
    ```

10) Также для получения доступа к результатам классификации Вы можете монтировать директорию хоста в Docker контейнер. Для этого необходимо запустить контейнер, выволнив следующию команду:
    ```console
    docker run -it -v <абсолютный путь до директории, в которую Вы хотите сохранить отчет классификации>:/app/output --name conclassifseven classifseven
    ```
    ##### *Примечание: в случае изменения текстового названия образа или контейнера в каком-либо из предыдущих пунктов необходимо соответствующим образом изменить названия и в команде для монтирования директории.*
    
# Возможные проблемы
Изменение размера входного изображения негативно влияет на точность классификации.

В случае появления ошибки о невозможности прочтения текстовых файлов, находящихся в директории `etalon` убедитесь, что они имеют кодировку `UTF-8` и используют способ       обозначения конца строки `UNIX (LF)`.
 
При использовании командной строки была замечена нестабильная работа вывода текстовых сообщений на русском языке в консоль. Причем ошибка появлялась в случайные моменты     времени и не зависела от длины текста и наличия в нём пробелов:
 <p align="center">
 <a href="https://ibb.co/bg7rx7gX"><img src="https://i.ibb.co/WWscQsWf/Docker-Text2-Crop.png" alt="Нестабильный вывод текстовых сообщений в консоль" border="0"></a>
 </p>

Проект был успешно запущен на VPS сервере под управлением OC Windows 11, RAM 8 GB.
